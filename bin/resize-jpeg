#!/usr/bin/env python

import os
import sys

from PIL import Image
import pyexiv2


def resize_img(dir_path, img_name, factor, quality):
    img_path = os.path.join(dir_path, img_name)
    metadata = pyexiv2.ImageMetadata(img_path)
    metadata.read()
    image = Image.open(img_path)
    width, height  = image.size
    new_image = image.resize((int(width * factor), int(height * factor)), Image.ANTIALIAS)
    new_image.save(img_name, quality=quality)
    metadata['Exif.Photo.PixelXDimension'] = new_image.size[0]
    metadata['Exif.Photo.PixelYDimension'] = new_image.size[1]
    metadata.write()


def dir_resize(dir_path, factor, quality):
    for path, dirs, files in os.walk(dir_path):
        for file_name in files:
            ext = file_name[-3:].lower()
            if ext in ('jpg', ):
                resize_img(path, file_name, factor, quality)


if __name__ == '__main__':
    try:
        dir_path = os.getcwd()
        factor = float(sys.argv[1])
        quality = int(sys.argv[2])
        dir_resize(dir_path, factor, quality)
        sys.exit(0)
    except IndexError:
        print 'Usage: resize-jpeg <resize-factor> <jpeg-quality>'
        sys.exit(1)
